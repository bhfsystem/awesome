#!/usr/bin/env bash

function bootstrap {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"
  source "$shome/script/profile"

  block compile virtualenv

  set +u; source "$shome/vendor/virtualenv/bin/activate"; set -u

  if [[ ! -f "$shome/vendor/ec2-cost-tools/.git" ]]; then
    (cd "$shome/vendor" && git clone git@github.com:balanced-ops/ec2-cost-tools)
  fi

  if pushd "$shome/vendor/ec2-cost-tools" >/dev/null; then
    pip install -e .
    popd >/dev/null
  fi

  ln -nfs ../vendor/virtualenv/bin/awslimitchecker ../vendor/virtualenv/bin/ec2-costs "$shome/bin/"
}

bootstrap
